<div class="page-header"><h1><%= gt.gettext("Gestion des ROMs") %> - <%= system.fullname %></h1></div>

<%- include('partials/breadcrumb', { breadCrumb: breadCrumb }); %>

<p><%= gt.gettext("Nombre total de ROMs :") %> <span data-rom-number><%= roms.list.length %></span></p>

<div class="alert alert-warning">
  <span class="glyphicon glyphicon-alert" aria-hidden="true"></span>
  <span class="sr-only"><%= gt.gettext("Attention :") %></span>
  <%= gt.gettext("Supprimer ou modifier des ROMs nécessite qu'EmulationStation soit redémarré pour prendre en compte les modifications.") %>
</div>

<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse-upload" aria-expanded="false" aria-controls="collapse-upload">
  <%= gt.gettext("Uploader des ROMs") %>
</button>
<div class="collapse" id="collapse-upload">
  <br />

  <div class="well">
    <p><%= gt.gettext("Une fois les ROMs uploadées, il faudra recharger la page pour les voir apparaître dans le listing.") %></p>

    <form action="/roms/upload" class="dropzone" enctype="multipart/form-data" id="roms-upload"
      data-drop-here="<%= gt.gettext('Déposer des fichiers ici pour les uploader.') %>"
      data-server-error="<%= uploadError %>">
      <input type="hidden" name="upload_path" value="<%= currentPath %>" />
    </form>
  </div>
</div>

<br />
<br />

<div class="sticky-alert center-block no-display" data-launch-alert="success">
  <div class="alert alert-success" role="alert">
    <strong><%= gt.gettext("Et voilà !") %></strong>
    <%= gt.gettext("Votre jeu devrait s'être lancé !") %>
  </div>
</div>

<div class="sticky-alert center-block no-display" data-launch-alert="error">
  <div class="alert alert-danger" role="alert">
    <strong><%= gt.gettext("Oups !") %></strong>
    <%= gt.gettext("Il semble que votre jeu n'ait pas réussi à se lancer.") %>
  </div>
</div>

<div class="sticky-alert center-block no-display" data-delete-alert="success">
  <div class="alert alert-success" role="alert">
    <strong><%= gt.gettext("Et voilà !") %></strong>
    <%= gt.gettext("Votre ROM a bien été supprimée !") %>
  </div>
</div>

<div class="sticky-alert center-block no-display" data-delete-alert="error">
  <div class="alert alert-danger" role="alert">
    <strong><%= gt.gettext("Oups !") %></strong>
    <%= gt.gettext("Il semble que votre ROM n'ait pas été supprimée.") %>
  </div>
</div>

<div class="sticky-alert center-block no-display" data-update-alert="success">
  <div class="alert alert-success" role="alert">
    <strong><%= gt.gettext("Et voilà !") %></strong>
    <%= gt.gettext("Les données de votre ROM ont bien été mises à jour !") %>
  </div>
</div>

<div class="sticky-alert center-block no-display" data-update-alert="error">
  <div class="alert alert-danger" role="alert">
    <strong><%= gt.gettext("Oups !") %></strong>
    <%= gt.gettext("Il semble que les données de votre ROM n'aient pas été mises à jour.") %>
  </div>
</div>

<% var lastIndex; %>
<% if (undefined !== subDirectories) { %>
  <% subDirectories.forEach(function (item, index) { %>
    <% if (1 === (index + 1) % 4) { %>
<div class="row">
    <% } %>
  <div class="col-sm-6 col-md-3">
    <div class="panel panel-default">
      <div class="panel-body text-center">
        <a href="<%= basePath %>/<%= item %>">
          <span class="glyphicon glyphicon-folder-open big-glyphicon" aria-hidden="true"></span>
        </a>
      </div>
      <div class="panel-footer"><a href="<%= basePath %>/<%= item %>"><%= item %></a></div>
    </div>
  </div>
    <% if (0 === (index + 1) % 4) { %>
</div>
    <% } %>
  <% lastIndex = index + 1; %>
  <% }); %>
<% } %>
<% if (lastIndex && 0 !== lastIndex % 4) { %>
</div>
<% } %>

<% roms.list.forEach (function (rom, index) { %>
  <% if (1 === (index + 1) % 4) { %>
<div class="row">
  <% } %>
  <div class="col-sm-6 col-md-3" data-row="<%= index %>">
    <div class="panel panel-default">
      <div class="panel-body">
        <div class="row text-center">
        <% if (rom.image) { %>
          <img src="<%= rom.image %>" alt="" class="col-md-7 col-lg-9 rom-image" />
        <% } else { %>
          <span class="glyphicon glyphicon-picture big-glyphicon col-md-7 col-lg-9 rom-image" aria-hidden="true"></span>
        <% } %>

          <div class="col-md-5 col-lg-3 center-block">
          <% if (1 == gameLaunchingAvailable) { %>
            <button class="btn btn-success has-spinner" type="submit" aria-label="<%= gt.gettext('Lancer') %>"
               data-play data-rom="<%= rom.fullname %>" data-system="<%= system.name %>">
              <span class="glyphicon glyphicon-refresh glyphicon-spin hidden" data-toggle-hidden></span>
              <span class="glyphicon glyphicon-play" aria-hidden="true" data-toggle-hidden></span>
            </button>
          <% } %>
            <button class="btn btn-danger" type="submit" aria-label="<%= gt.gettext('Supprimer') %>"
              data-toggle="modal" data-target="#deleteModal" data-fullname="<%= rom.fullname %>"
              data-filename="<%= rom.filename %>" data-index="<%= index %>">
              <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
            </button>
            <button class="btn btn-primary" type="submit" aria-label="<%= gt.gettext('Information') %>"
               data-toggle="modal" data-target="#updateModal" data-fullname="<%= rom.fullname %>"
               data-filename="<%= rom.filename %>" data-index="<%= index %>" data-desc="<%= rom.desc %>"
               data-genre="<%= rom.genre %>" data-players="<%= rom.players %>" data-publisher="<%= rom.publisher %>"
               data-releasedate-day="<%= rom.releasedate.day %>"
               data-releasedate-month="<%= rom.releasedate.month %>"
               data-releasedate-year="<%= rom.releasedate.year %>"
               data-rating="<%= rom.rating %>"
               data-developer="<%= rom.developer %>" data-update="trigger">
              <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
            </button>
          </div>
        </div>
      </div>
      <div class="panel-footer"><strong data-index="<%= index %>" data-rom-fullname><%= rom.fullname %></strong></div>
    </div>
  </div>
  <% if (0 === (index + 1) % 4) { %>
</div>
  <% } %>
<% }); %>

<a id="back-to-top" href="#" class="btn btn-primary btn-lg back-to-top" role="button" title="<%= gt.gettext('Cliquez pour retourner en haut de la page') %>" data-toggle="tooltip" data-placement="left">
  <span class="glyphicon glyphicon-chevron-up"></span>
</a>

<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalTitle">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="deleteModalTitle"><%= gt.gettext("Attention") %></h4>
      </div>
      <div class="modal-body">
        <p><%- deleteConfirmation %></p>

        <form method="post" action="/roms/delete" data-delete="form">
          <input type="hidden" name="rom" />
          <input type="hidden" data-index />
          <input type="hidden" name="current_path" value="<%= currentPath %>" />
          <input type="hidden" name="sub_path" value="<%= subPath %>" />
          <input type="hidden" name="system" value="<%= system.name %>" />
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal"><%= gt.gettext("Non") %></button>
        <button type="button" class="btn btn-warning" data-delete="confirm">
          <span class="glyphicon glyphicon-refresh glyphicon-spin hidden" data-toggle-hidden></span>
          <%= gt.gettext("Oui") %>
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModalTitle">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="updateModalTitle"><strong data-fullname></strong></h4>
      </div>
      <div class="modal-body">
        <form action="/roms/update" data-update="form" method="post" class="form-horizontal" data-index>
          <input type="hidden" name="rom" />
          <input type="hidden" name="sub_path" value="<%= subPath %>" />
          <input type="hidden" name="system" value="<%= system.name %>" />

          <div class="form-group">
            <label for="publisher" class="col-sm-3 control-label"><%= gt.gettext('Nom') %></label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="name" name="name" data-fullname-val />
            </div>
          </div>
          <div class="form-group">
            <label for="publisher" class="col-sm-3 control-label"><%= gt.gettext('Éditeur') %></label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="publisher" name="publisher" data-publisher />
            </div>
          </div>
          <div class="form-group">
            <label for="developer" class="col-sm-3 control-label"><%= gt.gettext('Développeur') %></label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="developer" name="developer" data-developer />
            </div>
          </div>
          <div class="form-group">
            <label for="releasedate" class="col-sm-3 control-label"><%= gt.gettext('Date de sortie') %></label>
            <div class="col-sm-9">
              <div class="row date-picker-select">
                <div class="col-xs-3">
                  <div class="form-group">
                    <select class="selectpicker form-control" id="releasedate-day" name="releasedate_day" data-releasedate-day>
                      <option value="00"><%= gt.gettext('Jour') %></option>
                    <% for (var x = 1; x < 32; x++) { %>
                      <option value="<%= ("0" + x).slice(-2) %>"><%= ("0" + x).slice(-2) %></option>
                    <% } %>
                    </select>
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <select class="selectpicker form-control" id="releasedate-month" name="releasedate_month" data-releasedate-month>
                      <option value="00"><%= gt.gettext('Mois') %></option>
                    <% for (var x = 1; x < 13; x++) { %>
                      <option value="<%= ("0" + x).slice(-2) %>"><%= ("0" + x).slice(-2) %></option>
                    <% } %>
                    </select>
                  </div>
                </div>
                <div class="col-xs-5">
                  <div class="form-group">
                    <input type="number" class="form-control" id="releasedate-year" name="releasedate_year" data-releasedate-year placeholder="<%= gt.gettext('Année') %>" />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="genre" class="col-sm-3 control-label"><%= gt.gettext('Genre') %></label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="genre" name="genre" data-genre />
            </div>
          </div>
          <div class="form-group">
            <label for="players" class="col-sm-3 control-label"><%= gt.gettext('Joueurs') %></label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="players" name="players" data-players />
            </div>
          </div>
          <div class="form-group">
            <label for="rating" class="col-sm-3 control-label"><%= gt.gettext('Note') %></label>
            <div class="col-sm-9">
              <div data-rating-div></div>
              <input type="hidden" name="rating" data-rating />
            </div>
          </div>
          <div class="form-group">
            <label for="desc" class="col-sm-3 control-label"><%= gt.gettext('Description') %></label>
            <div class="col-sm-9">
              <textarea class="form-control" id="desc" name="desc" rows="10" data-desc></textarea>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal"><%= gt.gettext('Fermer') %></button>
        <button type="button" class="btn btn-primary" data-update="confirm">
          <span class="glyphicon glyphicon-refresh glyphicon-spin hidden" data-toggle-hidden></span>
          <%= gt.gettext('Valider') %>
        </button>
      </div>
    </div>
  </div>
</div>
